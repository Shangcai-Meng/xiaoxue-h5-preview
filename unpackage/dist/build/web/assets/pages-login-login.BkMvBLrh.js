var t,e,i,s,a,o,n,r,l,h,c,u;import{v as d,x as p,a as m,o as f,b as g,w as y,d as b,y as v,k as w,z as S,n as x,i as _,I as k,A as C,e as $,t as T,j as P,B as q,C as I,f as N,F as D,g as B,D as M,E as F,G as z,H as A,J as j,K as W,L as O,M as X,h as Y,N as H,l as V,O as U,P as R,Q as E,R as Z,T as L,U as K,s as J,V as G,W as Q,X as tt,Y as et,Z as it,_ as st,$ as at,a0 as ot}from"./index-wgqImcLz.js";import{_ as nt}from"./uv-icon.B6TvUsnu.js";import{r as rt}from"./uni-app.es.DBKN6atv.js";import{_ as lt}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{useUserStore as ht}from"./store-modules-user.7AC2TseP.js";const ct=lt({name:"uv-input",mixins:[d,p,{props:{value:{type:[String,Number],default:""},modelValue:{type:[String,Number],default:""},type:{type:String,default:"text"},disabled:{type:Boolean,default:!1},disabledColor:{type:String,default:"#f5f7fa"},clearable:{type:Boolean,default:!1},password:{type:Boolean,default:!1},maxlength:{type:[String,Number],default:-1},placeholder:{type:String,default:null},placeholderClass:{type:String,default:"input-placeholder"},placeholderStyle:{type:[String,Object],default:"color: #c0c4cc"},confirmType:{type:String,default:"done"},confirmHold:{type:Boolean,default:!1},holdKeyboard:{type:Boolean,default:!1},focus:{type:Boolean,default:!1},autoBlur:{type:Boolean,default:!1},cursor:{type:[String,Number],default:-1},cursorSpacing:{type:[String,Number],default:30},selectionStart:{type:[String,Number],default:-1},selectionEnd:{type:[String,Number],default:-1},adjustPosition:{type:Boolean,default:!0},inputAlign:{type:String,default:"left"},fontSize:{type:[String,Number],default:"14px"},color:{type:String,default:"#303133"},prefixIcon:{type:String,default:""},prefixIconStyle:{type:[String,Object],default:""},suffixIcon:{type:String,default:""},suffixIconStyle:{type:[String,Object],default:""},border:{type:String,default:"surround"},readonly:{type:Boolean,default:!1},shape:{type:String,default:"square"},formatter:{type:[Function,null],default:null},ignoreCompositionEvent:{type:Boolean,default:!0},...null==(e=null==(t=uni.$uv)?void 0:t.props)?void 0:e.input}}],data:()=>({innerValue:"",focused:!1,innerFormatter:t=>t}),created(){this.innerValue=this.modelValue},watch:{value(t){this.innerValue=t},modelValue(t){this.innerValue=t}},computed:{isShowClear(){const{clearable:t,readonly:e,focused:i,innerValue:s}=this;return!!t&&!e&&!!i&&""!==s},inputClass(){let t=[],{border:e,disabled:i,shape:s}=this;return"surround"===e&&(t=t.concat(["uv-border","uv-input--radius"])),t.push(`uv-input--${s}`),"bottom"===e&&(t=t.concat(["uv-border-bottom","uv-input--no-radius"])),t.join(" ")},wrapperStyle(){const t={};return this.disabled&&(t.backgroundColor=this.disabledColor),"none"===this.border?t.padding="0":(t.paddingTop="6px",t.paddingBottom="6px",t.paddingLeft="9px",t.paddingRight="9px"),this.$uv.deepMerge(t,this.$uv.addStyle(this.customStyle))},inputStyle(){const t={color:this.color,fontSize:this.$uv.addUnit(this.fontSize),textAlign:this.inputAlign};return(this.disabled||this.readonly)&&(t["pointer-events"]="none"),t}},methods:{setFormatter(t){this.innerFormatter=t},onInput(t){let{value:e=""}=t.detail||{};const i=(this.formatter||this.innerFormatter)(e);this.innerValue=e,this.$nextTick(()=>{this.innerValue=i,this.valueChange()})},onBlur(t){this.$emit("blur",t.detail.value),this.$uv.sleep(100).then(()=>{this.focused=!1}),this.$uv.formValidate(this,"blur")},onFocus(t){this.focused=!0,this.$emit("focus")},onConfirm(t){this.$emit("confirm",this.innerValue)},onkeyboardheightchange(t){this.$emit("keyboardheightchange",t)},valueChange(){this.isClear&&(this.innerValue="");const t=this.innerValue;this.$nextTick(()=>{this.$emit("input",t),this.$emit("update:modelValue",t),this.$emit("change",t),this.$uv.formValidate(this,"change")})},onClear(){this.innerValue="",this.isClear=!0,this.$uv.sleep(100).then(t=>{this.isClear=!1}),this.$nextTick(()=>{this.$emit("clear"),this.valueChange()})},clickHandler(){}}},[["render",function(t,e,i,s,a,o){const n=rt(m("uv-icon"),nt),r=_,l=k;return f(),g(r,{class:x(["uv-input",o.inputClass]),style:S([o.wrapperStyle])},{default:y(()=>[b(r,{class:"uv-input__content"},{default:y(()=>[b(r,{class:"uv-input__content__prefix-icon"},{default:y(()=>[v(t.$slots,"prefix",{},()=>[t.prefixIcon?(f(),g(n,{key:0,name:t.prefixIcon,size:"18",customStyle:t.prefixIconStyle},null,8,["name","customStyle"])):w("",!0)],!0)]),_:3}),b(r,{class:"uv-input__content__field-wrapper",onClick:o.clickHandler},{default:y(()=>[b(l,{class:"uv-input__content__field-wrapper__field",style:S([o.inputStyle]),type:t.type,focus:t.focus,cursor:t.cursor,value:a.innerValue,"auto-blur":t.autoBlur,disabled:t.disabled||t.readonly,maxlength:t.maxlength,placeholder:t.placeholder,"placeholder-style":t.placeholderStyle,"placeholder-class":t.placeholderClass,"confirm-type":t.confirmType,"confirm-hold":t.confirmHold,"hold-keyboard":t.holdKeyboard,"cursor-spacing":t.cursorSpacing,"adjust-position":t.adjustPosition,"selection-end":t.selectionEnd,"selection-start":t.selectionStart,password:t.password||"password"===t.type||void 0,ignoreCompositionEvent:t.ignoreCompositionEvent,onInput:o.onInput,onBlur:o.onBlur,onFocus:o.onFocus,onConfirm:o.onConfirm,onKeyboardheightchange:o.onkeyboardheightchange},null,8,["style","type","focus","cursor","value","auto-blur","disabled","maxlength","placeholder","placeholder-style","placeholder-class","confirm-type","confirm-hold","hold-keyboard","cursor-spacing","adjust-position","selection-end","selection-start","password","ignoreCompositionEvent","onInput","onBlur","onFocus","onConfirm","onKeyboardheightchange"])]),_:1},8,["onClick"]),o.isShowClear?(f(),g(r,{key:0,class:"uv-input__content__clear",onClick:o.onClear},{default:y(()=>[b(n,{name:"close",size:"11",color:"#ffffff",customStyle:"line-height: 12px"})]),_:1},8,["onClick"])):w("",!0),b(r,{class:"uv-input__content__subfix-icon"},{default:y(()=>[v(t.$slots,"suffix",{},()=>[t.suffixIcon?(f(),g(n,{key:0,name:t.suffixIcon,size:"18",customStyle:t.suffixIconStyle},null,8,["name","customStyle"])):w("",!0)],!0)]),_:3})]),_:3})]),_:3},8,["class","style"])}],["__scopeId","data-v-f5be3788"]]);let ut=class{constructor(t,e){this.options=t,this.animation=C({...t}),this.currentStepAnimates={},this.next=0,this.$=e}_nvuePushAnimates(t,e){let i=this.currentStepAnimates[this.next],s={};if(s=i||{styles:{},config:{}},dt.includes(t)){s.styles.transform||(s.styles.transform="");let i="";"rotate"===t&&(i="deg"),s.styles.transform+=`${t}(${e+i}) `}else s.styles[t]=`${e}`;this.currentStepAnimates[this.next]=s}_animateRun(t={},e={}){let i=this.$.$refs.ani.ref;if(i)return new Promise((s,a)=>{nvueAnimation.transition(i,{styles:t,...e},t=>{s()})})}_nvueNextAnimate(t,e=0,i){let s=t[e];if(s){let{styles:a,config:o}=s;this._animateRun(a,o).then(()=>{e+=1,this._nvueNextAnimate(t,e,i)})}else this.currentStepAnimates={},"function"==typeof i&&i(),this.isEnd=!0}step(t={}){return this.animation.step(t),this}run(t){this.$.animationData=this.animation.export(),this.$.timer=setTimeout(()=>{"function"==typeof t&&t()},this.$.durationTime)}};const dt=["matrix","matrix3d","rotate","rotate3d","rotateX","rotateY","rotateZ","scale","scale3d","scaleX","scaleY","scaleZ","skew","skewX","skewY","translate","translate3d","translateX","translateY","translateZ"];function pt(t,e){if(e)return clearTimeout(e.timer),new ut(t,e)}dt.concat(["opacity","backgroundColor"],["width","height","left","right","top","bottom"]).forEach(t=>{ut.prototype[t]=function(...e){return this.animation[t](...e),this}});const mt=lt({name:"uv-transition",mixins:[d,p],emits:["click","change"],props:{show:{type:Boolean,default:!1},mode:{type:[Array,String,null],default:()=>"fade"},duration:{type:[String,Number],default:300},timingFunction:{type:String,default:"ease-out"},customClass:{type:String,default:""},cellChild:{type:Boolean,default:!1}},data:()=>({isShow:!1,transform:"",opacity:1,animationData:{},durationTime:300,config:{}}),watch:{show:{handler(t){t?this.open():this.isShow&&this.close()},immediate:!0}},computed:{transformStyles(){const t={transform:this.transform,opacity:this.opacity,...this.$uv.addStyle(this.customStyle),"transition-duration":this.duration/1e3+"s"};return this.$uv.addStyle(t,"string")}},created(){this.config={duration:this.duration,timingFunction:this.timingFunction,transformOrigin:"50% 50%",delay:0},this.durationTime=this.duration},methods:{init(t={}){t.duration&&(this.durationTime=t.duration),this.animation=pt(Object.assign(this.config,t),this)},onClick(){this.$emit("click",{detail:this.isShow})},step(t,e={}){if(this.animation){for(let e in t)try{"object"==typeof t[e]?this.animation[e](...t[e]):this.animation[e](t[e])}catch(i){console.error(`方法 ${e} 不存在`)}return this.animation.step(e),this}},run(t){this.animation&&this.animation.run(t)},open(){clearTimeout(this.timer),this.transform="",this.isShow=!0;let{opacity:t,transform:e}=this.styleInit(!1);void 0!==t&&(this.opacity=t),this.transform=e,this.$nextTick(()=>{this.timer=setTimeout(()=>{this.animation=pt(this.config,this),this.tranfromInit(!1).step(),this.animation.run(),this.opacity=1,this.$emit("change",{detail:this.isShow}),this.transform=""},20)})},close(t){this.animation&&this.tranfromInit(!0).step().run(()=>{this.isShow=!1,this.animationData=null,this.animation=null;let{opacity:t,transform:e}=this.styleInit(!1);this.opacity=t||1,this.transform=e,this.$emit("change",{detail:this.isShow})})},styleInit(t){let e={transform:""},i=(t,i)=>{"fade"===i?e.opacity=this.animationType(t)[i]:e.transform+=this.animationType(t)[i]+" "};return"string"==typeof this.mode?i(t,this.mode):this.mode.forEach(e=>{i(t,e)}),e},tranfromInit(t){let e=(t,e)=>{let i=null;"fade"===e?i=t?0:1:(i=t?"-100%":"0","zoom-in"===e&&(i=t?.8:1),"zoom-out"===e&&(i=t?1.2:1),"slide-right"===e&&(i=t?"100%":"0"),"slide-bottom"===e&&(i=t?"100%":"0")),this.animation[this.animationMode()[e]](i)};return"string"==typeof this.mode?e(t,this.mode):this.mode.forEach(i=>{e(t,i)}),this.animation},animationType:t=>({fade:t?1:0,"slide-top":`translateY(${t?"0":"-100%"})`,"slide-right":`translateX(${t?"0":"100%"})`,"slide-bottom":`translateY(${t?"0":"100%"})`,"slide-left":`translateX(${t?"0":"-100%"})`,"zoom-in":`scaleX(${t?1:.8}) scaleY(${t?1:.8})`,"zoom-out":`scaleX(${t?1:1.2}) scaleY(${t?1:1.2})`}),animationMode:()=>({fade:"opacity","slide-top":"translateY","slide-right":"translateX","slide-bottom":"translateY","slide-left":"translateX","zoom-in":"scale","zoom-out":"scale"}),toLine:t=>t.replace(/([A-Z])/g,"-$1").toLowerCase()}},[["render",function(t,e,i,s,a,o){const n=_;return a.isShow?(f(),g(n,{key:0,ref:"ani",animation:a.animationData,class:x(i.customClass),style:S(o.transformStyles),onClick:o.onClick},{default:y(()=>[v(t.$slots,"default")]),_:3},8,["animation","class","style","onClick"])):w("",!0)}]]);const ft=lt({name:"uv-line",mixins:[d,p,{props:{color:{type:String,default:"#d6d7d9"},length:{type:[String,Number],default:"100%"},direction:{type:String,default:"row"},hairline:{type:Boolean,default:!0},margin:{type:[String,Number],default:0},dashed:{type:Boolean,default:!1},...null==(s=null==(i=uni.$uv)?void 0:i.props)?void 0:s.line}}],computed:{lineStyle(){const t={};return t.margin=this.margin,"row"===this.direction?(t.borderBottomWidth="1px",t.borderBottomStyle=this.dashed?"dashed":"solid",t.width=this.$uv.addUnit(this.length),this.hairline&&(t.transform="scaleY(0.5)")):(t.borderLeftWidth="1px",t.borderLeftStyle=this.dashed?"dashed":"solid",t.height=this.$uv.addUnit(this.length),this.hairline&&(t.transform="scaleX(0.5)")),t.borderColor=this.color,this.$uv.deepMerge(t,this.$uv.addStyle(this.customStyle))}}},[["render",function(t,e,i,s,a,o){const n=_;return f(),g(n,{class:"uv-line",style:S([o.lineStyle])},null,8,["style"])}],["__scopeId","data-v-c767f31f"]]);const gt=lt({name:"uv-form-item",emits:["click"],mixins:[d,p,{props:{label:{type:String,default:""},prop:{type:String,default:""},borderBottom:{type:[Boolean],default:!1},labelPosition:{type:String,default:""},labelWidth:{type:[String,Number],default:""},rightIcon:{type:String,default:""},leftIcon:{type:String,default:""},required:{type:Boolean,default:!1},leftIconStyle:{type:[String,Object],default:""},...null==(o=null==(a=uni.$uv)?void 0:a.props)?void 0:o.formItem}}],data:()=>({message:"",parentData:{labelPosition:"left",labelAlign:"left",labelStyle:{},labelWidth:45,errorType:"message"}}),created(){this.init()},methods:{init(){this.updateParentData(),this.parent||this.$uv.error("uv-form-item需要结合uv-form组件使用")},updateParentData(){this.getParentData("uv-form")},clearValidate(){this.message=null},resetField(){const t=this.$uv.getProperty(this.parent.originalModel,this.prop);this.$uv.setProperty(this.parent.model,this.prop,t),this.message=null},clickHandler(){this.$emit("click")}}},[["render",function(t,e,i,s,a,o){const n=P,r=rt(m("uv-icon"),nt),l=_,h=rt(m("uv-transition"),mt),c=rt(m("uv-line"),ft);return f(),g(l,{class:"uv-form-item"},{default:y(()=>[b(l,{class:"uv-form-item__body",onClick:o.clickHandler,style:S([t.$uv.addStyle(t.customStyle),{flexDirection:"left"===(t.labelPosition||a.parentData.labelPosition)?"row":"column"}])},{default:y(()=>[v(t.$slots,"label",{},()=>[t.required||t.leftIcon||t.label?(f(),g(l,{key:0,class:"uv-form-item__body__left",style:S({width:t.$uv.addUnit(t.labelWidth||a.parentData.labelWidth),marginBottom:"left"===a.parentData.labelPosition?0:"5px"})},{default:y(()=>[b(l,{class:"uv-form-item__body__left__content"},{default:y(()=>[t.required?(f(),g(n,{key:0,class:"uv-form-item__body__left__content__required"},{default:y(()=>[$("*")]),_:1})):w("",!0),t.leftIcon?(f(),g(l,{key:1,class:"uv-form-item__body__left__content__icon"},{default:y(()=>[b(r,{name:t.leftIcon,"custom-style":t.leftIconStyle},null,8,["name","custom-style"])]),_:1})):w("",!0),b(n,{class:"uv-form-item__body__left__content__label",style:S([a.parentData.labelStyle,{justifyContent:"left"===a.parentData.labelAlign?"flex-start":"center"===a.parentData.labelAlign?"center":"flex-end"}])},{default:y(()=>[$(T(t.label),1)]),_:1},8,["style"])]),_:1})]),_:1},8,["style"])):w("",!0)],!0),b(l,{class:"uv-form-item__body__right"},{default:y(()=>[b(l,{class:"uv-form-item__body__right__content"},{default:y(()=>[b(l,{class:"uv-form-item__body__right__content__slot"},{default:y(()=>[v(t.$slots,"default",{},void 0,!0)]),_:3}),b(l,{class:"item__body__right__content__icon"},{default:y(()=>[v(t.$slots,"right",{},void 0,!0)]),_:3})]),_:3})]),_:3})]),_:3},8,["onClick","style"]),v(t.$slots,"error",{},()=>[a.message&&"message"===a.parentData.errorType?(f(),g(h,{key:0,show:!0,duration:100,mode:"fade"},{default:y(()=>[b(n,{class:"uv-form-item__body__right__message",style:S({marginLeft:t.$uv.addUnit("top"===a.parentData.labelPosition?0:t.labelWidth||a.parentData.labelWidth)})},{default:y(()=>[$(T(a.message),1)]),_:1},8,["style"])]),_:1})):w("",!0)],!0),t.borderBottom?(f(),g(c,{key:0,color:a.message&&"border-bottom"===a.parentData.errorType?"#f56c6c":"#d6d7d9"},null,8,["color"])):w("",!0)]),_:3})}],["__scopeId","data-v-d5bbf17c"]]),yt={props:{model:{type:Object,default:()=>({})},rules:{type:[Object,Function,Array],default:()=>({})},errorType:{type:String,default:"message"},borderBottom:{type:Boolean,default:!0},labelPosition:{type:String,default:"left"},labelWidth:{type:[String,Number],default:45},labelAlign:{type:String,default:"left"},labelStyle:{type:Object,default:()=>({})},...null==(r=null==(n=uni.$uv)?void 0:n.props)?void 0:r.form}};const bt=/%[sdj%]/g;let vt=function(){};function wt(t){if(!t||!t.length)return null;const e={};return t.forEach(t=>{const{field:i}=t;e[i]=e[i]||[],e[i].push(t)}),e}function St(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];let s=1;const a=e[0],o=e.length;if("function"==typeof a)return a.apply(null,e.slice(1));if("string"==typeof a){let t=String(a).replace(bt,t=>{if("%%"===t)return"%";if(s>=o)return t;switch(t){case"%s":return String(e[s++]);case"%d":return Number(e[s++]);case"%j":try{return JSON.stringify(e[s++])}catch(i){return"[Circular]"}break;default:return t}});for(let i=e[s];s<o;i=e[++s])t+=` ${i}`;return t}return a}function xt(t,e){return null==t||(!("array"!==e||!Array.isArray(t)||t.length)||!(!function(t){return"string"===t||"url"===t||"hex"===t||"email"===t||"pattern"===t}(e)||"string"!=typeof t||t))}function _t(t,e,i){let s=0;const a=t.length;!function o(n){if(n&&n.length)return void i(n);const r=s;s+=1,r<a?e(t[r],o):i([])}([])}function kt(t,e,i,s){if(e.first){const e=new Promise((e,a)=>{const o=function(t){const e=[];return Object.keys(t).forEach(i=>{e.push.apply(e,t[i])}),e}(t);_t(o,i,function(t){return s(t),t.length?a({errors:t,fields:wt(t)}):e()})});return e.catch(t=>t),e}let a=e.firstFields||[];!0===a&&(a=Object.keys(t));const o=Object.keys(t),n=o.length;let r=0;const l=[],h=new Promise((e,h)=>{const c=function(t){if(l.push.apply(l,t),r++,r===n)return s(l),l.length?h({errors:l,fields:wt(l)}):e()};o.length||(s(l),e()),o.forEach(e=>{const s=t[e];-1!==a.indexOf(e)?_t(s,i,c):function(t,e,i){const s=[];let a=0;const o=t.length;function n(t){s.push.apply(s,t),a++,a===o&&i(s)}t.forEach(t=>{e(t,n)})}(s,i,c)})});return h.catch(t=>t),h}function Ct(t){return function(e){return e&&e.message?(e.field=e.field||t.fullField,e):{message:"function"==typeof e?e():e,field:e.field||t.fullField}}}function $t(t,e){if(e)for(const i in e)if(e.hasOwnProperty(i)){const s=e[i];"object"==typeof s&&"object"==typeof t[i]?t[i]={...t[i],...s}:t[i]=s}return t}function Tt(t,e,i,s,a,o){!t.required||i.hasOwnProperty(t.field)&&!xt(e,o||t.type)||s.push(St(a.messages.required,t.fullField))}const Pt={email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,url:new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://|//)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i"),hex:/^#?([a-f0-9]{6}|[a-f0-9]{3})$/i};var qt={integer:function(t){return/^(-)?\d+$/.test(t)},float:function(t){return/^(-)?\d+(\.\d+)?$/.test(t)},array:function(t){return Array.isArray(t)},regexp:function(t){if(t instanceof RegExp)return!0;try{return!!new RegExp(t)}catch(e){return!1}},date:function(t){return"function"==typeof t.getTime&&"function"==typeof t.getMonth&&"function"==typeof t.getYear},number:function(t){return!isNaN(t)&&"number"==typeof+t},object:function(t){return"object"==typeof t&&!qt.array(t)},method:function(t){return"function"==typeof t},email:function(t){return"string"==typeof t&&!!t.match(Pt.email)&&t.length<255},url:function(t){return"string"==typeof t&&!!t.match(Pt.url)},hex:function(t){return"string"==typeof t&&!!t.match(Pt.hex)}};const It="enum";const Nt={required:Tt,whitespace:function(t,e,i,s,a){(/^\s+$/.test(e)||""===e)&&s.push(St(a.messages.whitespace,t.fullField))},type:function(t,e,i,s,a){if(t.required&&void 0===e)return void Tt(t,e,i,s,a);const o=t.type;["integer","float","array","regexp","object","method","email","number","date","url","hex"].indexOf(o)>-1?qt[o](e)||s.push(St(a.messages.types[o],t.fullField,t.type)):o&&typeof e!==t.type&&s.push(St(a.messages.types[o],t.fullField,t.type))},range:function(t,e,i,s,a){const o="number"==typeof t.len,n="number"==typeof t.min,r="number"==typeof t.max,l=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;let h=e,c=null;const u="number"==typeof e,d="string"==typeof e,p=Array.isArray(e);if(u?c="number":d?c="string":p&&(c="array"),!c)return!1;p&&(h=e.length),d&&(h=e.replace(l,"_").length),o?h!==t.len&&s.push(St(a.messages[c].len,t.fullField,t.len)):n&&!r&&h<t.min?s.push(St(a.messages[c].min,t.fullField,t.min)):r&&!n&&h>t.max?s.push(St(a.messages[c].max,t.fullField,t.max)):n&&r&&(h<t.min||h>t.max)&&s.push(St(a.messages[c].range,t.fullField,t.min,t.max))},enum:function(t,e,i,s,a){t[It]=Array.isArray(t[It])?t[It]:[],-1===t[It].indexOf(e)&&s.push(St(a.messages[It],t.fullField,t[It].join(", ")))},pattern:function(t,e,i,s,a){if(t.pattern)if(t.pattern instanceof RegExp)t.pattern.lastIndex=0,t.pattern.test(e)||s.push(St(a.messages.pattern.mismatch,t.fullField,e,t.pattern));else if("string"==typeof t.pattern){new RegExp(t.pattern).test(e)||s.push(St(a.messages.pattern.mismatch,t.fullField,e,t.pattern))}}};function Dt(t,e,i,s,a){const o=t.type,n=[];if(t.required||!t.required&&s.hasOwnProperty(t.field)){if(xt(e,o)&&!t.required)return i();Nt.required(t,e,s,n,a,o),xt(e,o)||Nt.type(t,e,s,n,a)}i(n)}const Bt={string:function(t,e,i,s,a){const o=[];if(t.required||!t.required&&s.hasOwnProperty(t.field)){if(xt(e,"string")&&!t.required)return i();Nt.required(t,e,s,o,a,"string"),xt(e,"string")||(Nt.type(t,e,s,o,a),Nt.range(t,e,s,o,a),Nt.pattern(t,e,s,o,a),!0===t.whitespace&&Nt.whitespace(t,e,s,o,a))}i(o)},method:function(t,e,i,s,a){const o=[];if(t.required||!t.required&&s.hasOwnProperty(t.field)){if(xt(e)&&!t.required)return i();Nt.required(t,e,s,o,a),void 0!==e&&Nt.type(t,e,s,o,a)}i(o)},number:function(t,e,i,s,a){const o=[];if(t.required||!t.required&&s.hasOwnProperty(t.field)){if(""===e&&(e=void 0),xt(e)&&!t.required)return i();Nt.required(t,e,s,o,a),void 0!==e&&(Nt.type(t,e,s,o,a),Nt.range(t,e,s,o,a))}i(o)},boolean:function(t,e,i,s,a){const o=[];if(t.required||!t.required&&s.hasOwnProperty(t.field)){if(xt(e)&&!t.required)return i();Nt.required(t,e,s,o,a),void 0!==e&&Nt.type(t,e,s,o,a)}i(o)},regexp:function(t,e,i,s,a){const o=[];if(t.required||!t.required&&s.hasOwnProperty(t.field)){if(xt(e)&&!t.required)return i();Nt.required(t,e,s,o,a),xt(e)||Nt.type(t,e,s,o,a)}i(o)},integer:function(t,e,i,s,a){const o=[];if(t.required||!t.required&&s.hasOwnProperty(t.field)){if(xt(e)&&!t.required)return i();Nt.required(t,e,s,o,a),void 0!==e&&(Nt.type(t,e,s,o,a),Nt.range(t,e,s,o,a))}i(o)},float:function(t,e,i,s,a){const o=[];if(t.required||!t.required&&s.hasOwnProperty(t.field)){if(xt(e)&&!t.required)return i();Nt.required(t,e,s,o,a),void 0!==e&&(Nt.type(t,e,s,o,a),Nt.range(t,e,s,o,a))}i(o)},array:function(t,e,i,s,a){const o=[];if(t.required||!t.required&&s.hasOwnProperty(t.field)){if(xt(e,"array")&&!t.required)return i();Nt.required(t,e,s,o,a,"array"),xt(e,"array")||(Nt.type(t,e,s,o,a),Nt.range(t,e,s,o,a))}i(o)},object:function(t,e,i,s,a){const o=[];if(t.required||!t.required&&s.hasOwnProperty(t.field)){if(xt(e)&&!t.required)return i();Nt.required(t,e,s,o,a),void 0!==e&&Nt.type(t,e,s,o,a)}i(o)},enum:function(t,e,i,s,a){const o=[];if(t.required||!t.required&&s.hasOwnProperty(t.field)){if(xt(e)&&!t.required)return i();Nt.required(t,e,s,o,a),void 0!==e&&Nt.enum(t,e,s,o,a)}i(o)},pattern:function(t,e,i,s,a){const o=[];if(t.required||!t.required&&s.hasOwnProperty(t.field)){if(xt(e,"string")&&!t.required)return i();Nt.required(t,e,s,o,a),xt(e,"string")||Nt.pattern(t,e,s,o,a)}i(o)},date:function(t,e,i,s,a){const o=[];if(t.required||!t.required&&s.hasOwnProperty(t.field)){if(xt(e)&&!t.required)return i();if(Nt.required(t,e,s,o,a),!xt(e)){let i;i="number"==typeof e?new Date(e):e,Nt.type(t,i,s,o,a),i&&Nt.range(t,i.getTime(),s,o,a)}}i(o)},url:Dt,hex:Dt,email:Dt,required:function(t,e,i,s,a){const o=[],n=Array.isArray(e)?"array":typeof e;Nt.required(t,e,s,o,a,n),i(o)},any:function(t,e,i,s,a){const o=[];if(t.required||!t.required&&s.hasOwnProperty(t.field)){if(xt(e)&&!t.required)return i();Nt.required(t,e,s,o,a)}i(o)}};function Mt(){return{default:"Validation error on field %s",required:"%s is required",enum:"%s must be one of %s",whitespace:"%s cannot be empty",date:{format:"%s date %s is invalid for format %s",parse:"%s date could not be parsed, %s is invalid ",invalid:"%s date %s is invalid"},types:{string:"%s is not a %s",method:"%s is not a %s (function)",array:"%s is not an %s",object:"%s is not an %s",number:"%s is not a %s",date:"%s is not a %s",boolean:"%s is not a %s",integer:"%s is not an %s",float:"%s is not a %s",regexp:"%s is not a valid %s",email:"%s is not a valid %s",url:"%s is not a valid %s",hex:"%s is not a valid %s"},string:{len:"%s must be exactly %s characters",min:"%s must be at least %s characters",max:"%s cannot be longer than %s characters",range:"%s must be between %s and %s characters"},number:{len:"%s must equal %s",min:"%s cannot be less than %s",max:"%s cannot be greater than %s",range:"%s must be between %s and %s"},array:{len:"%s must be exactly %s in length",min:"%s cannot be less than %s in length",max:"%s cannot be greater than %s in length",range:"%s must be between %s and %s in length"},pattern:{mismatch:"%s value %s does not match pattern %s"},clone:function(){const t=JSON.parse(JSON.stringify(this));return t.clone=this.clone,t}}}const Ft=Mt();function zt(t){this.rules=null,this._messages=Ft,this.define(t)}zt.prototype={messages:function(t){return t&&(this._messages=$t(Mt(),t)),this._messages},define:function(t){if(!t)throw new Error("Cannot configure a schema with no rules");if("object"!=typeof t||Array.isArray(t))throw new Error("Rules must be an object");let e,i;for(e in this.rules={},t)t.hasOwnProperty(e)&&(i=t[e],this.rules[e]=Array.isArray(i)?i:[i])},validate:function(t,e,i){const s=this;void 0===e&&(e={}),void 0===i&&(i=function(){});let a,o,n=t,r=e,l=i;if("function"==typeof r&&(l=r,r={}),!this.rules||0===Object.keys(this.rules).length)return l&&l(),Promise.resolve();if(r.messages){let t=this.messages();t===Ft&&(t=Mt()),$t(t,r.messages),r.messages=t}else r.messages=this.messages();const h={};(r.keys||Object.keys(this.rules)).forEach(e=>{a=s.rules[e],o=n[e],a.forEach(i=>{let a=i;"function"==typeof a.transform&&(n===t&&(n={...n}),o=n[e]=a.transform(o)),a="function"==typeof a?{validator:a}:{...a},a.validator=s.getValidationMethod(a),a.field=e,a.fullField=a.fullField||e,a.type=s.getType(a),a.validator&&(h[e]=h[e]||[],h[e].push({rule:a,value:o,source:n,field:e}))})});const c={};return kt(h,r,(t,e)=>{const{rule:i}=t;let s,a=!("object"!==i.type&&"array"!==i.type||"object"!=typeof i.fields&&"object"!=typeof i.defaultField);function o(t,e){return{...e,fullField:`${i.fullField}.${t}`}}function n(s){void 0===s&&(s=[]);let n=s;if(Array.isArray(n)||(n=[n]),!r.suppressWarning&&n.length&&zt.warning("async-validator:",n),n.length&&i.message&&(n=[].concat(i.message)),n=n.map(Ct(i)),r.first&&n.length)return c[i.field]=1,e(n);if(a){if(i.required&&!t.value)return n=i.message?[].concat(i.message).map(Ct(i)):r.error?[r.error(i,St(r.messages.required,i.field))]:[],e(n);let s={};if(i.defaultField)for(const e in t.value)t.value.hasOwnProperty(e)&&(s[e]=i.defaultField);s={...s,...t.rule.fields};for(const t in s)if(s.hasOwnProperty(t)){const e=Array.isArray(s[t])?s[t]:[s[t]];s[t]=e.map(o.bind(null,t))}const a=new zt(s);a.messages(r.messages),t.rule.options&&(t.rule.options.messages=r.messages,t.rule.options.error=r.error),a.validate(t.value,t.rule.options||r,t=>{const i=[];n&&n.length&&i.push.apply(i,n),t&&t.length&&i.push.apply(i,t),e(i.length?i:null)})}else e(n)}a=a&&(i.required||!i.required&&t.value),i.field=t.field,i.asyncValidator?s=i.asyncValidator(i,t.value,n,t.source,r):i.validator&&(s=i.validator(i,t.value,n,t.source,r),!0===s?n():!1===s?n(i.message||`${i.field} fails`):s instanceof Array?n(s):s instanceof Error&&n(s.message)),s&&s.then&&s.then(()=>n(),t=>n(t))},t=>{!function(t){let e,i=[],s={};function a(t){if(Array.isArray(t)){let e;i=(e=i).concat.apply(e,t)}else i.push(t)}for(e=0;e<t.length;e++)a(t[e]);i.length?s=wt(i):(i=null,s=null),l(i,s)}(t)})},getType:function(t){if(void 0===t.type&&t.pattern instanceof RegExp&&(t.type="pattern"),"function"!=typeof t.validator&&t.type&&!Bt.hasOwnProperty(t.type))throw new Error(St("Unknown rule type %s",t.type));return t.type||"string"},getValidationMethod:function(t){if("function"==typeof t.validator)return t.validator;const e=Object.keys(t),i=e.indexOf("message");return-1!==i&&e.splice(i,1),1===e.length&&"required"===e[0]?Bt.required:Bt[this.getType(t)]||!1}},zt.register=function(t,e){if("function"!=typeof e)throw new Error("Cannot register a validator by type, validator is not a function");Bt[t]=e},zt.warning=vt,zt.messages=Ft,zt.warning=function(){};const At=lt({name:"uv-form",mixins:[d,p,yt],provide(){return{uForm:this}},data:()=>({formRules:{},validator:{},originalModel:null}),watch:{rules:{immediate:!0,handler(t){this.setRules(t)}},propsChange(t){var e;(null==(e=this.children)?void 0:e.length)&&this.children.map(t=>{"function"==typeof t.updateParentData&&t.updateParentData()})},model:{immediate:!0,handler(t){this.originalModel||(this.originalModel=this.$uv.deepClone(t))}}},computed:{propsChange(){return[this.errorType,this.borderBottom,this.labelPosition,this.labelWidth,this.labelAlign,this.labelStyle]}},created(){this.children=[]},methods:{setRules(t){0!==Object.keys(t).length&&(this.formRules=t,this.validator=new zt(t))},resetFields(){this.resetModel()},resetModel(t){this.children.map(t=>{const e=null==t?void 0:t.prop,i=this.$uv.getProperty(this.originalModel,e);this.$uv.setProperty(this.model,e,i)})},clearValidate(t){t=[].concat(t),this.children.map(e=>{(void 0===t[0]||t.includes(e.prop))&&(e.message=null)})},async validateField(t,e,i=null){this.$nextTick(()=>{const s=[];t=[].concat(t),this.children.map(e=>{const a=[];if(t.includes(e.prop)){const t=this.$uv.getProperty(this.model,e.prop),o=e.prop.split("."),n=o[o.length-1],r=this.formRules[e.prop];if(!r)return;const l=[].concat(r);for(let h=0;h<l.length;h++){const o=l[h],r=[].concat(null==o?void 0:o.trigger);if(i&&!r.includes(i))continue;new zt({[n]:o}).validate({[n]:t},(t,i)=>{this.$uv.test.array(t)&&(s.push(...t),a.push(...t)),this.$nextTick(()=>{var t,i;e.message=(null==(t=a[0])?void 0:t.message)?null==(i=a[0])?void 0:i.message:null})})}}}),"function"==typeof e&&e(s)})},validate(t){return new Promise((t,e)=>{this.$nextTick(()=>{const i=this.children.map(t=>t.prop);this.validateField(i,i=>{i.length?("toast"===this.errorType&&this.$uv.toast(i[0].message),e(i)):t(!0)})})})}}},[["render",function(t,e,i,s,a,o){const n=_;return f(),g(n,{class:"uv-form"},{default:y(()=>[v(t.$slots,"default")]),_:3})}]]);const jt=lt({name:"uv-loading-icon",mixins:[d,p,{props:{show:{type:Boolean,default:!0},color:{type:String,default:"#909193"},textColor:{type:String,default:"#909193"},vertical:{type:Boolean,default:!1},mode:{type:String,default:"spinner"},size:{type:[String,Number],default:24},textSize:{type:[String,Number],default:15},textStyle:{type:Object,default:()=>({})},text:{type:[String,Number],default:""},timingFunction:{type:String,default:"linear"},duration:{type:[String,Number],default:1200},inactiveColor:{type:String,default:""},...null==(h=null==(l=uni.$uv)?void 0:l.props)?void 0:h.loadingIcon}}],data:()=>({array12:Array.from({length:12}),aniAngel:360,webviewHide:!1,loading:!1}),computed:{otherBorderColor(){const t=q(this.color,"#ffffff",100)[80];return"circle"===this.mode?this.inactiveColor?this.inactiveColor:t:"transparent"}},watch:{show(t){}},mounted(){this.init()},methods:{init(){setTimeout(()=>{},20)},addEventListenerToWebview(){const t=I(),e=t[t.length-1].$getAppWebview();e.addEventListener("hide",()=>{this.webviewHide=!0}),e.addEventListener("show",()=>{this.webviewHide=!1})}}},[["render",function(t,e,i,s,a,o){const n=_,r=P;return t.show?(f(),g(n,{key:0,class:x(["uv-loading-icon",[t.vertical&&"uv-loading-icon--vertical"]]),style:S([t.$uv.addStyle(t.customStyle)])},{default:y(()=>[a.webviewHide?w("",!0):(f(),g(n,{key:0,class:x(["uv-loading-icon__spinner",[`uv-loading-icon__spinner--${t.mode}`]]),ref:"ani",style:S({color:t.color,width:t.$uv.addUnit(t.size),height:t.$uv.addUnit(t.size),borderTopColor:t.color,borderBottomColor:o.otherBorderColor,borderLeftColor:o.otherBorderColor,borderRightColor:o.otherBorderColor,"animation-duration":`${t.duration}ms`,"animation-timing-function":"semicircle"===t.mode||"circle"===t.mode?t.timingFunction:""})},{default:y(()=>["spinner"===t.mode?(f(!0),N(D,{key:0},B(a.array12,(t,e)=>(f(),g(n,{key:e,class:"uv-loading-icon__dot"}))),128)):w("",!0)]),_:1},8,["class","style"])),t.text?(f(),g(r,{key:1,class:"uv-loading-icon__text",style:S([{fontSize:t.$uv.addUnit(t.textSize),color:t.textColor},t.$uv.addStyle(t.textStyle)])},{default:y(()=>[$(T(t.text),1)]),_:1},8,["style"])):w("",!0)]),_:1},8,["style","class"])):w("",!0)}],["__scopeId","data-v-d9c6b36a"]]);const Wt=lt({name:"uv-button",mixins:[d,p,{props:{hairline:{type:Boolean,default:!0},type:{type:String,default:"info"},size:{type:String,default:"normal"},shape:{type:String,default:"square"},plain:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},loadingText:{type:[String,Number],default:""},loadingMode:{type:String,default:"spinner"},loadingSize:{type:[String,Number],default:14},openType:{type:String,default:""},formType:{type:String,default:""},appParameter:{type:String,default:""},hoverStopPropagation:{type:Boolean,default:!0},lang:{type:String,default:"en"},sessionFrom:{type:String,default:""},sendMessageTitle:{type:String,default:""},sendMessagePath:{type:String,default:""},sendMessageImg:{type:String,default:""},showMessageCard:{type:Boolean,default:!0},dataName:{type:String,default:""},throttleTime:{type:[String,Number],default:0},hoverStartTime:{type:[String,Number],default:0},hoverStayTime:{type:[String,Number],default:200},text:{type:[String,Number],default:""},icon:{type:String,default:""},iconSize:{type:[String,Number],default:""},iconColor:{type:String,default:"#000000"},color:{type:String,default:""},customTextStyle:{type:[Object,String],default:""},...null==(u=null==(c=uni.$uv)?void 0:c.props)?void 0:u.button}}],emits:["click"],data:()=>({}),computed:{bemClass(){return this.color?this.bem("button",["shape","size"],["disabled","plain","hairline"]):this.bem("button",["type","shape","size"],["disabled","plain","hairline"])},loadingColor(){return this.plain?this.color?this.color:"#3c9cff":"info"===this.type?"#c9c9c9":"rgb(200, 200, 200)"},iconColorCom(){return this.iconColor?this.iconColor:this.plain?this.color?this.color:this.type:"info"===this.type?"#000000":"#ffffff"},baseColor(){let t={};return this.color&&(t.color=this.plain?this.color:"white",this.plain||(t["background-color"]=this.color),-1!==this.color.indexOf("gradient")?(t.borderTopWidth=0,t.borderRightWidth=0,t.borderBottomWidth=0,t.borderLeftWidth=0,this.plain||(t.backgroundImage=this.color)):(t.borderColor=this.color,t.borderWidth="1px",t.borderStyle="solid")),t},nvueTextStyle(){let t={};return"info"===this.type&&(t.color="#323233"),this.color&&(t.color=this.plain?this.color:"white"),t.fontSize=this.textSize+"px",t},textSize(){let t=14,{size:e}=this;return"large"===e&&(t=16),"normal"===e&&(t=14),"small"===e&&(t=12),"mini"===e&&(t=10),t},getIconSize(){const t=this.iconSize?this.iconSize:1.35*this.textSize;return this.$uv.addUnit(t)},btnWrapperStyle(){const t={},e=this.$uv.addStyle(this.customStyle);return e.width&&(t.width=e.width),t}},methods:{clickHandler(){this.disabled||this.loading||M(()=>{this.$emit("click")},this.throttleTime)}}},[["render",function(t,e,i,s,a,o){const n=rt(m("uv-loading-icon"),jt),r=P,l=rt(m("uv-icon"),nt),h=F,c=_;return f(),g(c,{class:"uv-button-wrapper",style:S([o.btnWrapperStyle])},{default:y(()=>[b(h,{"hover-start-time":Number(t.hoverStartTime),"hover-stay-time":Number(t.hoverStayTime),"form-type":t.formType,"open-type":t.openType,"app-parameter":t.appParameter,"hover-stop-propagation":t.hoverStopPropagation,"send-message-title":t.sendMessageTitle,"send-message-path":t.sendMessagePath,lang:t.lang,"data-name":t.dataName,"session-from":t.sessionFrom,"send-message-img":t.sendMessageImg,"show-message-card":t.showMessageCard,"hover-class":t.disabled||t.loading?"":"uv-button--active",class:x(["uv-button uv-reset-button",o.bemClass]),style:S([o.baseColor,t.$uv.addStyle(t.customStyle)]),onClick:o.clickHandler},{default:y(()=>[t.loading?(f(),N(D,{key:0},[b(n,{mode:t.loadingMode,size:1.15*t.loadingSize,color:o.loadingColor},null,8,["mode","size","color"]),b(r,{class:"uv-button__loading-text",style:S([{fontSize:o.textSize+"px"},t.$uv.addStyle(t.customTextStyle)])},{default:y(()=>[$(T(t.loadingText||t.text),1)]),_:1},8,["style"])],64)):(f(),N(D,{key:1},[t.icon?(f(),g(l,{key:0,name:t.icon,color:o.iconColorCom,size:o.getIconSize,customStyle:{marginRight:"2px"}},null,8,["name","color","size"])):w("",!0),v(t.$slots,"default",{},()=>[b(r,{class:"uv-button__text",style:S([{fontSize:o.textSize+"px"},t.$uv.addStyle(t.customTextStyle)])},{default:y(()=>[$(T(t.text),1)]),_:1},8,["style"])],!0),v(t.$slots,"suffix",{},void 0,!0)],64))]),_:3},8,["hover-start-time","hover-stay-time","form-type","open-type","app-parameter","hover-stop-propagation","send-message-title","send-message-path","lang","data-name","session-from","send-message-img","show-message-card","hover-class","style","onClick","class"])]),_:3},8,["style"])}],["__scopeId","data-v-74b376fb"]]),Ot=Math.abs,Xt=t=>Math.sqrt(t.x*t.x+t.y*t.y);function Yt(t){const e=function(t){for(var e=t.split(","),i=e[0].match(/:(.*?);/)[1],s=atob(e[1]),a=s.length,o=new Uint8Array(a);a--;)o[a]=s.charCodeAt(a);return new Blob([o],{type:i})}(t);return URL.createObjectURL(e)}const Ht=lt({components:{cropper:lt({props:{width:{type:[String,Number],default:"100%"},height:{type:[String,Number],default:"100%"},cutWidth:{type:[String,Number],default:"50%"},cutHeight:{type:[String,Number],default:0},minWidth:{type:Number,default:50},minHeight:{type:Number,default:50},center:{type:Boolean,default:!0},src:String,disableScale:Boolean,disableRotate:Boolean,disableTranslate:Boolean,disableCtrl:Boolean,boundDetect:Boolean,freeBoundDetect:Boolean,keepRatio:Boolean,disablePreview:Boolean,showCtrlBorder:Boolean,resetCut:Boolean,fit:{type:Boolean,default:!0},imageCenter:Boolean,maxZoom:{type:Number,default:10},minZoom:{type:Number,default:1},angle:{type:Number,default:0},zoom:{type:Number,default:1},offset:{type:Array,default:()=>[0,0]},background:{type:String,default:"#000"},canvasBackground:{type:String,default:"#fff"},canvasZoom:{type:Number,default:1},fileType:{type:String,default:"png",validator:t=>["png","jpg"].includes(t)},quality:{type:Number,default:1},maskType:{type:String,default:"shadow"},circleView:Boolean},data:()=>({transform:{angle:0,translate:{x:0,y:0},zoom:1},corner:{left:50,right:50,bottom:50,top:50},image:{originWidth:0,originHeight:0,width:0,height:0},ctrlWidth:0,ctrlHeight:0,view:!1,canvasId:""}),computed:{transformMeta:function(){const t=this.transform;return`translate3d(${t.translate.x}px,${t.translate.y}px,0)rotate(${t.angle}deg)scale(${t.zoom})`},ctrlStyle:function(){const t=this.corner;let e=`left:${t.left}px;top:${t.top}px;right:${t.right}px;bottom:${t.bottom}px;`;return"outline"!==this.maskType?e+=`box-shadow:0 0 0 50000rpx rgba(0,0,0,${this.view?.8:.4})`:e+=`outline:rgba(0,0,0,${this.view?.8:.4})solid 5000px`,e}},watch:{src:function(){this.resetCut&&this.resetCutReact(),this.initImage()}},created(){this.canvasId=(()=>{const t="abcdefghijklmnopqrstuvwxyz",e=t.split("").concat(t.toUpperCase().split("")).concat("0123456789".split(""));let i,s=e.length;for(;s;){i=Math.floor(Math.random()*s--);const t=e[s];e[s]=e[i],e[i]=t}return e.slice(0,16).join("")})(),z().then(t=>{t=t[1]||{windowWidth:375,windowHeight:736},this.ratio=t.windowWidth/750,this.windowHeight=t.windowHeight,this.init(),this.initCanvas()})},methods:{toPx(t){return-1!==t.indexOf("%")?Math.floor(Number(t.replace("%",""))/100*this.containerWidth):-1!==t.indexOf("rpx")?Math.floor(Number(t.replace("rpx",""))*this.ratio):Math.floor(Number(t.replace("px","")))},initCanvas(){const t=A().in(this);t.select(".nice-cropper").boundingClientRect(),t.exec(t=>{this.containerWidth=t[0].width,this.containerHeight=t[0].height,this.initCut()})},resetCutReact(){this.ctrlWidth=Math.min(this.toPx(this.cutWidth),this.containerWidth),this.cutHeight?this.ctrlHeight=Math.min(this.toPx(this.cutHeight),this.containerHeight):this.ctrlHeight=Math.min(this.ctrlWidth,this.containerHeight);const t=this.center?Math.floor((this.containerWidth-this.ctrlWidth)/2):0,e=this.center?Math.floor((this.containerHeight-this.ctrlHeight)/2):0;this.cutRatio=this.ctrlHeight/this.ctrlWidth,this.corner={left:t,right:this.containerWidth-this.ctrlWidth-t,top:e,bottom:this.containerHeight-this.ctrlHeight-e}},initCut(){this.resetCutReact(),this.initImage()},async initImage(){this.src&&j({src:this.src,success:t=>{this.$emit("load",t),this.image.originWidth=t.width,this.image.originHeight=t.height,this.image.width=this.fit?this.ctrlWidth:this.image.originWidth,this.image.height=t.height/t.width*this.image.width,this.img=t.path;const e=[0,0];this.imageCenter&&(e[0]=(this.ctrlWidth-this.image.width)/2,e[1]=(this.ctrlHeight-this.image.height)/2),e[0]+=this.offset[0]||0,e[1]+=this.offset[1]||0,this.setTranslate(e),this.setZoom(this.zoom),this.transform.angle=this.freeBoundDetect||!this.disableRotate?this.angle:0,this.setBoundary(),this.preview(),setTimeout(()=>{this.draw()},100)},fail:t=>{t&&this.$emit("error",t)}})},init(){this.pretouch={},this.handles={},this.preVector={x:0,y:0},this.distance=30,this.touch={},this.movetouch={},this.cutMode=!1,this.params={zoom:1,deltaX:0,deltaY:0,diffX:0,diffY:0,angle:0}},start(t){this.src||t.preventDefault();const e=t.touches?t.touches[0]:t,i=this.touch,s=Date.now();if(i.startX=e.pageX,i.startY=e.pageY,i.startTime=s,this.doubleTap=!1,this.view=!1,clearTimeout(this.previewTimer),t.touches.length>1){var a=t.touches[1];this.preVector={x:a.pageX-this.touch.startX,y:a.pageY-this.touch.startY},this.startDistance=Xt(this.preVector)}else{let t=this.pretouch;this.doubleTap=this.pretouch.time&&s-this.pretouch.time<300&&Ot(i.startX-t.startX)<30&&Ot(i.startY-t.startY)<30&&Ot(i.startTime-t.time)<300,t={startX:this.touch.startX,startY:this.touch.startY,time:this.touch.startTime}}},move(t){if(!this.src)return;const e=t.touches?t.touches[0]:t;if(t.touches.length>1){const r=t.touches[1],l={x:r.pageX-e.pageX,y:r.pageY-e.pageY};if(null!==this.preVector.x){if(this.startDistance){const t=Xt(l);this.params.zoom=Xt(l)/this.startDistance,this.startDistance=t,this.cutMode&&!this.disableCtrl?this.setCut():!this.disableScale&&this.pinch()}this.params.angle=(i=l,s=this.preVector,(n=Xt(i)*Xt(s))?(a=(i.x*s.x+i.y*s.y)/n,o=Math.acos(Math.min(a,1)),180*(o=i.x*s.y-s.x*i.y>0?-o:o)/Math.PI):0),this.cutMode&&!this.disableCtrl?this.setCut():!this.disableRotate&&this.rotate()}this.preVector.x=l.x,this.preVector.y=l.y}else{const t=e.pageX-this.touch.startX,i=e.pageY-this.touch.startY;this.params.diffY=i,this.params.diffX=t,this.movetouch.x?(this.params.deltaX=e.pageX-this.movetouch.x,this.params.deltaY=e.pageY-this.movetouch.y):this.params.deltaX=this.params.deltaY=0,(Ot(t)>30||Ot(i)>30)&&(this.doubleTap=!1),this.cutMode&&!this.disableCtrl?this.setCut():!this.disableTranslate&&this.translate(),this.movetouch.x=e.pageX,this.movetouch.y=e.pageY}var i,s,a,o,n;!this.cutMode&&this.setBoundary(),t.touches.length>1&&t.preventDefault()},end(){this.doubleTap&&this.$emit("doubleTap"),this.cutMode&&this.setBoundary(),this.init(),!this.disablePreview&&this.preview(),this.draw()},translate(){const t=this.transform.translate,e=this.params;t.x+=e.deltaX,t.y+=e.deltaY},pinch(){this.transform.zoom*=this.params.zoom},rotate(){this.transform.angle+=this.params.angle},setZoom(t){t=Math.min(Math.max(Number(t)||1,this.minZoom),this.maxZoom),this.transform.zoom=t},setTranslate(t){if(Array.isArray(t)){const e=Number(t[0]),i=Number(t[1]);this.transform.translate.x=isNaN(e)?this.transform.translate.x:this.corner.left+e,this.transform.translate.y=isNaN(i)?this.transform.translate.y:this.corner.top+i}},setRotate(t){this.transform.angle=Number(t)||0},setTransform(t,e,i,s){this.setTranslate([t,e]),this.setZoom(s),this.setRotate(i)},setCutMode(t){this.src&&(this.cutMode=!0,this.cutDirection=t)},setCut(){const t=this.corner,e=this.params;switch(this.setMeta(this.cutDirection,e),this.keepRatio&&("lt"===this.cutDirection||"rb"===this.cutDirection?e.deltaY=e.deltaX*this.cutRatio:e.deltaX=e.deltaY/this.cutRatio),this.cutDirection){case"lt":t.top+=e.deltaY,t.left+=e.deltaX;break;case"rt":t.top+=e.deltaY,t.right-=this.keepRatio?-e.deltaX:e.deltaX;break;case"rb":t.right-=e.deltaX,t.bottom-=e.deltaY;break;case"lb":t.bottom-=e.deltaY,t.left+=this.keepRatio?-e.deltaX:e.deltaX}this.ctrlWidth=this.containerWidth-t.left-t.right,this.ctrlHeight=this.containerHeight-t.top-t.bottom},setMeta(t,e){const{ctrlWidth:i,ctrlHeight:s,minWidth:a,minHeight:o}=this;switch(t){case"lt":(e.deltaX>0||e.deltaY>0)&&(e.deltaX=Math.min(e.deltaX,i-a),e.deltaY=Math.min(e.deltaY,s-o));break;case"rt":(e.deltaX<0||e.deltaY>0)&&(e.deltaX=Math.max(e.deltaX,a-i),e.deltaY=Math.min(e.deltaY,s-o));break;case"rb":(e.deltaX<0||e.deltaY<0)&&(e.deltaX=Math.max(e.deltaX,a-i),e.deltaY=Math.max(e.deltaY,o-s));break;case"lb":(e.deltaX>0||e.deltaY<0)&&(e.deltaX=Math.min(e.deltaX,i-a),e.deltaY=Math.max(e.deltaY,o-s))}},setBoundary(){let t=this.transform.zoom;if(t=t<this.minZoom?this.minZoom:t>this.maxZoom?this.maxZoom:t,this.transform.zoom=t,!this.boundDetect||!this.disableRotate&&!this.freeBoundDetect)return!0;const e=this.transform.translate,i=this.corner,s=i.left-this.image.width+this.ctrlWidth-this.image.width*(t-1)/2,a=i.left+this.image.width*(t-1)/2,o=i.top-this.image.height+this.ctrlHeight-this.image.height*(t-1)/2,n=i.top+this.image.height*(t-1)/2;e.x=Math.floor(e.x<s?s:e.x>a?a:e.x),e.y=Math.floor(e.y<o?o:e.y>n?n:e.y)},preview(){clearTimeout(this.previewTimer),this.previewTimer=setTimeout(()=>{this.view=!0},500)},draw(){const t=W(this.canvasId,this),e=this.transform,i=this.corner,s=this.canvasZoom,a=this.image;t.save(),t.setFillStyle(this.canvasBackground),this.$emit("beforeDraw",t,e);const o=e.zoom;t.fillRect(0,0,this.ctrlWidth*s,this.ctrlHeight*s),t.translate((e.translate.x-i.left+a.width/2)*s,(e.translate.y-i.top+a.height/2)*s),t.rotate(e.angle*Math.PI/180),t.translate(-a.width*o*.5*s,-a.height*o*.5*s),t.drawImage(this.img,0,0,a.width*o*s,a.height*o*s),t.restore(),this.$emit("afterDraw",t,{width:this.ctrlWidth*s,height:this.ctrlHeight*s}),t.draw(!1)},runCrop(){return new Promise((t,e)=>{W(this.canvasId,this),O({canvasId:this.canvasId,quality:this.quality||1,fileType:this.fileType,success:e=>{t({url:e.tempFilePath})},fail:t=>{console.error(t)}},this)})},emptyFunc(){}}},[["render",function(t,e,i,s,a,o){const n=Y,r=_,l=H;return f(),N("div",{style:{height:"100%",width:"100%",display:"flex","justify-content":"center","align-items":"center","background-color":"black"},onMousemove:e[4]||(e[4]=X((...e)=>t.emptyFunc&&t.emptyFunc(...e),["stop"]))},[b(r,{class:"nice-cropper",style:S({height:t.height,width:t.width,background:t.background}),onTouchstart:t.start,onTouchmove:X(t.move,["stop"]),onTouchcancel:t.end,onTouchend:t.end},{default:y(()=>[b(n,{class:"nice-cropper__image",src:t.src,style:S({transform:t.transformMeta,width:t.image.width+"px",height:t.image.height+"px"})},null,8,["src","style"]),b(r,{class:x(["nice-cropper__ctrls",{"nice-cropper__ctrls--view":t.view,"nice-cropper__ctrls--border":t.showCtrlBorder,"nice-cropper__ctrls--circle":t.view&&t.circleView&&"outline"!==t.maskType}]),style:S(t.ctrlStyle)},{default:y(()=>[b(r,{class:"nice-cropper__corner nice-cropper__corner--lt",onTouchstart:e[0]||(e[0]=e=>t.setCutMode("lt"))}),b(r,{class:"nice-cropper__corner nice-cropper__corner--rt",onTouchstart:e[1]||(e[1]=e=>t.setCutMode("rt"))}),b(r,{class:"nice-cropper__corner nice-cropper__corner--rb",onTouchstart:e[2]||(e[2]=e=>t.setCutMode("rb"))}),b(r,{class:"nice-cropper__corner nice-cropper__corner--lb",onTouchstart:e[3]||(e[3]=e=>t.setCutMode("lb"))})]),_:1},8,["class","style"]),t.canvasId?(f(),g(l,{key:0,id:t.canvasId,"canvas-id":t.canvasId,style:S([{position:"absolute",left:"-500000px",top:"-500000px"},{width:t.ctrlWidth*t.canvasZoom+"px",height:t.ctrlHeight*t.canvasZoom+"px"}])},null,8,["id","canvas-id","style"])):w("",!0)]),_:1},8,["style","onTouchstart","onTouchmove","onTouchcancel","onTouchend"])],32)}],["__scopeId","data-v-c8866294"]])},data:()=>({src:null,cutWidth:250,cutHeight:250,canvasZoom:1,confirmFunc:()=>{},cancelFunc:()=>{},dialogVisible:!1}),onLoad:function(t){},methods:{show(t){return this.cutHeight=Math.round(t.h/t.w*680)+"rpx",this.cutWidth="680rpx",this.canvasZoom=750/V().windowWidth*t.w/680,this.avatarUrl=t.avatarUrl,U({title:"加载中"}),this.avatarUrl?this.src=this.avatarUrl:R({count:1,success:t=>{let e=t.tempFilePaths[0];this.src=e}}),new Promise((t,e)=>{this.dialogVisible=!0,this.confirmFunc=t,this.cancelFunc=e})},loadimage(t){E()},tapComplete:function(t){this.$refs["image-cropper"].runCrop().then(t=>new Promise((e,i)=>{Z({filePath:t.url,success:t=>{e(t)},fail:t=>{i(t)}})}).then(e=>{console.log("fileInfo",t.url,e),this.confirmFunc({tempFilePath:Yt(t.url),size:e.size})})).then(()=>{this.dialogVisible=!1})},tapCancel(){this.dialogVisible=!1,this.cancelFunc()}}},[["render",function(t,e,i,s,a,o){const n=L("cropper"),r=_;return a.dialogVisible?(f(),g(r,{key:0,class:"page-root"},{default:y(()=>[b(n,{ref:"image-cropper",disableRotate:!0,disableCtrl:"",src:a.src,onLoad:o.loadimage,resetCut:!0,cutWidth:a.cutWidth,cutHeight:a.cutHeight,canvasZoom:a.canvasZoom},null,8,["src","onLoad","cutWidth","cutHeight","canvasZoom"]),b(r,{class:"page-buttons"},{default:y(()=>[a.src?(f(),g(r,{key:0,class:"page-button page-button-submit","hover-class":"hover-btn",onClick:o.tapComplete},{default:y(()=>[$("确定 ")]),_:1},8,["onClick"])):w("",!0),b(r,{class:"page-button-cancel","hover-class":"hover-btn",onClick:o.tapCancel},{default:y(()=>[$("取消 ")]),_:1},8,["onClick"])]),_:1})]),_:1})):w("",!0)}],["__scopeId","data-v-e1d3dfff"]]);class Vt{constructor(t,e){this.options=t,this.animation=C(t),this.currentStepAnimates={},this.next=0,this.$=e}_nvuePushAnimates(t,e){let i=this.currentStepAnimates[this.next],s={};if(s=i||{styles:{},config:{}},Ut.includes(t)){s.styles.transform||(s.styles.transform="");let i="";"rotate"===t&&(i="deg"),s.styles.transform+=`${t}(${e+i}) `}else s.styles[t]=`${e}`;this.currentStepAnimates[this.next]=s}_animateRun(t={},e={}){let i=this.$.$refs.ani.ref;if(i)return new Promise((s,a)=>{nvueAnimation.transition(i,{styles:t,...e},t=>{s()})})}_nvueNextAnimate(t,e=0,i){let s=t[e];if(s){let{styles:a,config:o}=s;this._animateRun(a,o).then(()=>{e+=1,this._nvueNextAnimate(t,e,i)})}else this.currentStepAnimates={},"function"==typeof i&&i(),this.isEnd=!0}step(t={}){return this.animation.step(t),this}run(t){this.$.animationData=this.animation.export(),this.$.timer=setTimeout(()=>{"function"==typeof t&&t()},this.$.durationTime)}}const Ut=["matrix","matrix3d","rotate","rotate3d","rotateX","rotateY","rotateZ","scale","scale3d","scaleX","scaleY","scaleZ","skew","skewX","skewY","translate","translate3d","translateX","translateY","translateZ"];function Rt(t,e){if(e)return clearTimeout(e.timer),new Vt(t,e)}Ut.concat(["opacity","backgroundColor"],["width","height","left","right","top","bottom"]).forEach(t=>{Vt.prototype[t]=function(...e){return this.animation[t](...e),this}});const Et={name:"uniPopup",components:{UniTransition:lt({name:"uniTransition",emits:["click","change"],props:{show:{type:Boolean,default:!1},modeClass:{type:[Array,String],default:()=>"fade"},duration:{type:Number,default:300},styles:{type:Object,default:()=>({})},customClass:{type:String,default:""}},data:()=>({isShow:!1,transform:"",opacity:1,animationData:{},durationTime:300,config:{}}),watch:{show:{handler(t){t?this.open():this.isShow&&this.close()},immediate:!0}},computed:{stylesObject(){let t={...this.styles,"transition-duration":this.duration/1e3+"s"},e="";for(let i in t){e+=this.toLine(i)+":"+t[i]+";"}return e},transformStyles(){return"transform:"+this.transform+";opacity:"+this.opacity+";"+this.stylesObject}},created(){this.config={duration:this.duration,timingFunction:"ease",transformOrigin:"50% 50%",delay:0},this.durationTime=this.duration},methods:{init(t={}){t.duration&&(this.durationTime=t.duration),this.animation=Rt(Object.assign(this.config,t),this)},onClick(){this.$emit("click",{detail:this.isShow})},step(t,e={}){if(this.animation){for(let e in t)try{"object"==typeof t[e]?this.animation[e](...t[e]):this.animation[e](t[e])}catch(i){console.error(`方法 ${e} 不存在`)}return this.animation.step(e),this}},run(t){this.animation&&this.animation.run(t)},open(){clearTimeout(this.timer),this.transform="",this.isShow=!0;let{opacity:t,transform:e}=this.styleInit(!1);void 0!==t&&(this.opacity=t),this.transform=e,this.$nextTick(()=>{this.timer=setTimeout(()=>{this.animation=Rt(this.config,this),this.tranfromInit(!1).step(),this.animation.run(),this.$emit("change",{detail:this.isShow})},20)})},close(t){this.animation&&this.tranfromInit(!0).step().run(()=>{this.isShow=!1,this.animationData=null,this.animation=null;let{opacity:t,transform:e}=this.styleInit(!1);this.opacity=t||1,this.transform=e,this.$emit("change",{detail:this.isShow})})},styleInit(t){let e={transform:""},i=(t,i)=>{"fade"===i?e.opacity=this.animationType(t)[i]:e.transform+=this.animationType(t)[i]+" "};return"string"==typeof this.modeClass?i(t,this.modeClass):this.modeClass.forEach(e=>{i(t,e)}),e},tranfromInit(t){let e=(t,e)=>{let i=null;"fade"===e?i=t?0:1:(i=t?"-100%":"0","zoom-in"===e&&(i=t?.8:1),"zoom-out"===e&&(i=t?1.2:1),"slide-right"===e&&(i=t?"100%":"0"),"slide-bottom"===e&&(i=t?"100%":"0")),this.animation[this.animationMode()[e]](i)};return"string"==typeof this.modeClass?e(t,this.modeClass):this.modeClass.forEach(i=>{e(t,i)}),this.animation},animationType:t=>({fade:t?1:0,"slide-top":`translateY(${t?"0":"-100%"})`,"slide-right":`translateX(${t?"0":"100%"})`,"slide-bottom":`translateY(${t?"0":"100%"})`,"slide-left":`translateX(${t?"0":"-100%"})`,"zoom-in":`scaleX(${t?1:.8}) scaleY(${t?1:.8})`,"zoom-out":`scaleX(${t?1:1.2}) scaleY(${t?1:1.2})`}),animationMode:()=>({fade:"opacity","slide-top":"translateY","slide-right":"translateX","slide-bottom":"translateY","slide-left":"translateX","zoom-in":"scale","zoom-out":"scale"}),toLine:t=>t.replace(/([A-Z])/g,"-$1").toLowerCase()}},[["render",function(t,e,i,s,a,o){const n=_;return a.isShow?(f(),g(n,{key:0,ref:"ani",animation:a.animationData,class:x(i.customClass),style:S(o.transformStyles),onClick:o.onClick},{default:y(()=>[v(t.$slots,"default")]),_:3},8,["animation","class","style","onClick"])):w("",!0)}]])},emits:["change","maskClick"],props:{animation:{type:Boolean,default:!0},type:{type:String,default:"center"},maskClick:{type:Boolean,default:!0},backgroundColor:{type:String,default:"none"},safeArea:{type:Boolean,default:!0}},watch:{type:{handler:function(t){this.config[t]&&this[this.config[t]](!0)},immediate:!0},isDesktop:{handler:function(t){this.config[t]&&this[this.config[this.type]](!0)},immediate:!0},maskClick:{handler:function(t){this.mkclick=t},immediate:!0}},data(){return{duration:300,ani:[],showPopup:!1,showTrans:!1,popupWidth:0,popupHeight:0,config:{top:"top",bottom:"bottom",center:"center",left:"left",right:"right",message:"top",dialog:"center",share:"bottom"},maskClass:{position:"fixed",bottom:0,top:0,left:0,right:0,backgroundColor:"rgba(0, 0, 0, 0.4)"},transClass:{position:"fixed",left:0,right:0},maskShow:!0,mkclick:!0,popupstyle:this.isDesktop?"fixforpc-top":"top"}},computed:{isDesktop(){return this.popupWidth>=500&&this.popupHeight>=500},bg(){return""===this.backgroundColor||"none"===this.backgroundColor?"transparent":this.backgroundColor}},mounted(){(()=>{const{windowWidth:t,windowHeight:e,windowTop:i,safeAreaInsets:s}=V();this.popupWidth=t,this.popupHeight=e+i,this.safeArea?this.safeAreaInsets=s:this.safeAreaInsets=0})()},created(){this.mkclick=this.maskClick,this.animation?this.duration=300:this.duration=0,this.messageChild=null,this.clearPropagation=!1},methods:{closeMask(){this.maskShow=!1},disableMask(){this.mkclick=!1},clear(t){t.stopPropagation(),this.clearPropagation=!0},open(t){t&&-1!==["top","center","bottom","left","right","message","dialog","share"].indexOf(t)||(t=this.type),this.config[t]?(this[this.config[t]](),this.$emit("change",{show:!0,type:t})):console.error("缺少类型：",t)},close(t){this.showTrans=!1,this.$emit("change",{show:!1,type:this.type}),clearTimeout(this.timer),this.timer=setTimeout(()=>{this.showPopup=!1},300)},touchstart(){this.clearPropagation=!1},onTap(){this.clearPropagation?this.clearPropagation=!1:(this.$emit("maskClick"),this.mkclick&&this.close())},top(t){this.popupstyle=this.isDesktop?"fixforpc-top":"top",this.ani=["slide-top"],this.transClass={position:"fixed",left:0,right:0,backgroundColor:this.bg},t||(this.showPopup=!0,this.showTrans=!0,this.$nextTick(()=>{this.messageChild&&"message"===this.type&&this.messageChild.timerClose()}))},bottom(t){this.popupstyle="bottom",this.ani=["slide-bottom"],this.transClass={position:"fixed",left:0,right:0,bottom:0,paddingBottom:this.safeAreaInsets&&this.safeAreaInsets.bottom||0,backgroundColor:this.bg},t||(this.showPopup=!0,this.showTrans=!0)},center(t){this.popupstyle="center",this.ani=["zoom-out","fade"],this.transClass={position:"fixed",display:"flex",flexDirection:"column",bottom:0,left:0,right:0,top:0,justifyContent:"center",alignItems:"center"},t||(this.showPopup=!0,this.showTrans=!0)},left(t){this.popupstyle="left",this.ani=["slide-left"],this.transClass={position:"fixed",left:0,bottom:0,top:0,backgroundColor:this.bg,display:"flex",flexDirection:"column"},t||(this.showPopup=!0,this.showTrans=!0)},right(t){this.popupstyle="right",this.ani=["slide-right"],this.transClass={position:"fixed",bottom:0,right:0,top:0,backgroundColor:this.bg,display:"flex",flexDirection:"column"},t||(this.showPopup=!0,this.showTrans=!0)}}};function Zt(t){return"[object Object]"===Object.prototype.toString.call(t)}function Lt(t){return"[object Array]"===Object.prototype.toString.call(t)}function Kt(t,e){if(Zt(t)&&Zt(e))for(let[i,s]of Object.entries(e))Zt(s)||Lt(s)?t[i]=Kt(t[i],s):t[i]=s;else if(Lt(t)&&Lt(e))for(let[i,s]of Object.entries(e))Zt(s)||Lt(s)?t[i]=Kt(t[i],s):t.push(s);return t}const Jt=lt({name:"UserProfileDialog",props:{paddingBottom:{type:String,default:"0rpx"},imgWidth:{type:Number,default:132}},components:{ImageCropper:Ht,UniPopup:lt(Et,[["render",function(t,e,i,s,a,o){const n=L("uni-transition"),r=_;return a.showPopup?(f(),g(r,{key:0,class:x(["uni-popup",[a.popupstyle,o.isDesktop?"fixforpc-z-index":""]]),onTouchmove:X(o.clear,["stop","prevent"])},{default:y(()=>[b(r,{onTouchstart:o.touchstart},{default:y(()=>[a.maskShow?(f(),g(n,{key:"1",name:"mask","mode-class":"fade",styles:a.maskClass,duration:a.duration,show:a.showTrans,onClick:o.onTap},null,8,["styles","duration","show","onClick"])):w("",!0),b(n,{key:"2","mode-class":a.ani,name:"content",styles:a.transClass,duration:a.duration,show:a.showTrans,onClick:o.onTap},{default:y(()=>[b(r,{class:x(["uni-popup__wrapper",[a.popupstyle]]),style:S({backgroundColor:o.bg}),onClick:o.clear},{default:y(()=>[v(t.$slots,"default",{},void 0,!0)]),_:3},8,["style","class","onClick"])]),_:3},8,["mode-class","styles","duration","show","onClick"])]),_:3},8,["onTouchstart"])]),_:3},8,["class","onTouchmove"])):w("",!0)}],["__scopeId","data-v-00d02d99"]])},data:()=>({title:"请输入头像和昵称",confirmFunc:()=>{},cancelFunc:()=>{},cancel:!1,formData:{avatarUrl:null,nickName:null},options:{desc:null,nickName:{requried:!0,disable:!1},avatarUrl:{requried:!0,disable:!1}},isCanEdit:!0}),methods:{show(t){t&&Kt(this.options,t);let e=[];return this.options.avatarUrl.disable||e.push("头像"),this.options.nickName.disable||e.push("昵称"),this.title="请输入"+e.join("和"),this.tips={avatar:"请授上传头像",nickName:"请授输入昵称"},this.cancel=!1,new Promise((t,e)=>{this.$refs.popup.open(),this.confirmFunc=t,this.cancelFunc=e})},tapAvatar(t){new Promise((e,i)=>{j({src:t.detail.avatarUrl,success:t=>{e(t)},fail:t=>{i(t)}})}).then(e=>e.width>this.imgWidth||e.height>this.imgWidth?this.$refs.imageCropper.show({w:this.imgWidth,h:this.imgWidth,avatarUrl:t.detail.avatarUrl}):Promise.resolve({tempFilePath:t.detail.avatarUrl})).then(t=>(console.log(t),function(t){return K({file:t.tempFilePath}).then(t=>({url:t.data.url})).catch(e=>(console.error("上传头像失败:",e),{url:t.tempFilePath}))}(t).then(t=>{this.formData.avatarUrl=t.url})))},tapChooseImage(){R({count:1}).then(t=>{console.log(t);let e=null;e=t[t.length-1].tempFilePaths[0],this.tapAvatar({detail:{avatarUrl:e}})})},onGetUserInfo(t){this.formData.avatarUrl=t.detail.userInfo.avatar,this.formData.nickName=t.detail.userInfo.nickName},onSubmit(t){if(t.detail.value.nickName&&(this.formData.nickName=t.detail.value.nickName),!this.formData.avatarUrl&&!this.options.avatarUrl.disable&&this.options.avatarUrl.requried)return void J({icon:"none",title:this.tips.avatar});if((null==(e=this.formData.nickName)||0==e.trim().length)&&!this.options.nickName.disable&&this.options.nickName.requried)return void J({icon:"none",title:this.tips.nickName});var e;let i=Object.assign({},this.formData);this.confirmFunc(i),this.$refs.popup.close()},close(){this.$refs.popup.close()},tapCancel(){this.cancel=!0,this.$refs.popup.close()},onPopupChange(t){t.show||this.cancelFunc(this.cancel?"cancel":"close")}}},[["render",function(t,e,i,s,a,o){const n=Y,r=F,l=k,h=Q,c=L("uni-popup"),u=L("ImageCropper");return f(),N("div",null,[b(c,{ref:"popup",type:"bottom",onChange:o.onPopupChange},{default:y(()=>[G("div",{class:"popup-root"},[b(h,{onSubmit:o.onSubmit},{default:y(()=>[G("div",{class:"header"},T(a.title),1),a.options.desc?(f(),N("div",{key:0,class:"desc"},T(a.options.desc),1)):w("",!0),G("div",{class:"content"},[a.options.avatarUrl.disable?w("",!0):(f(),N("div",{key:0,class:"section-line"},[G("div",{class:"section-line-title"},"头像"),b(r,{class:"avatar-wrapper flex-cnsc",onClick:o.tapChooseImage},{default:y(()=>[b(n,{mode:"aspectFit",class:"avatar",src:a.formData.avatarUrl},null,8,["src"])]),_:1},8,["onClick"])])),a.options.nickName.disable?w("",!0):(f(),N("div",{key:1,class:"section-line"},[G("div",{class:"section-line-title"},"昵称"),b(l,{class:"section-line-inputText",type:"nickname",name:"nickName",placeholder:"请输入昵称",modelValue:a.formData.nickName,"onUpdate:modelValue":e[0]||(e[0]=t=>a.formData.nickName=t),maxlength:"16"},null,8,["modelValue"])]))]),G("div",{class:"footer"},[b(r,{type:"default",class:"btn btn-cancel",onClick:o.tapCancel},{default:y(()=>[$("取消")]),_:1},8,["onClick"]),b(r,{type:"primary",formType:"submit",class:"btn flex-cncc"},{default:y(()=>[$("确认")]),_:1})])]),_:1},8,["onSubmit"]),G("div",{style:S({height:i.paddingBottom})},null,4)])]),_:1},8,["onChange"]),b(u,{ref:"imageCropper"},null,512)])}],["__scopeId","data-v-d7b41f8d"]]);const Gt=lt({components:{CuiUserProfileDialog:Jt},data:()=>({loading:!1,formData:{username:"",password:""},rules:{username:[{required:!0,message:"请输入账号",trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]}]}}),methods:{async handleLogin(){const t=ht();try{await this.$refs.form.validate()}catch(e){return}this.loading=!0;try{await t.login(this.formData),await t.getUserInfo();const e=t.userInfo;e.avatar&&e.nickname?this.navigateToHome():await this.showProfileDialog(e)}catch(e){tt(e.message||"登录失败")}finally{this.loading=!1}},async showProfileDialog(t){try{const e=await this.$refs.userProfileDialog.show({desc:"请完善个人资料",avatarUrl:{requried:!0,disable:!!t.avatar},nickName:{requried:!0,disable:!!t.nickname}});await this.updateUserProfile(e)}catch(e){console.log("用户取消设置资料"),this.navigateToHome()}},async updateUserProfile(t){try{et("正在更新资料");const e={};t.avatarUrl&&(e.avatar=t.avatarUrl),t.nickName&&(e.nickname=t.nickName),await it(e);const i=ht();i.userInfo={...i.userInfo,avatar:e.avatar,nickname:e.nickname},tt("资料更新成功"),this.navigateToHome()}catch(e){console.error("更新资料失败:",e),tt(e.message||"更新资料失败"),this.navigateToHome()}finally{st()}},navigateToHome(){ot(),at({url:"/pages/index/index"})}}},[["render",function(t,e,i,s,a,o){const n=rt(m("uv-input"),ct),r=rt(m("uv-form-item"),gt),l=rt(m("uv-form"),At),h=rt(m("uv-button"),Wt),c=_,u=rt(m("cui-userprofiledialog"),Jt);return f(),g(c,{class:"container"},{default:y(()=>[b(c,{class:"login-form"},{default:y(()=>[b(l,{model:a.formData,ref:"form"},{default:y(()=>[b(r,{label:"账号",prop:"username"},{default:y(()=>[b(n,{modelValue:a.formData.username,"onUpdate:modelValue":e[0]||(e[0]=t=>a.formData.username=t),placeholder:"请输入账号"},null,8,["modelValue"])]),_:1}),b(r,{label:"密码",prop:"password"},{default:y(()=>[b(n,{modelValue:a.formData.password,"onUpdate:modelValue":e[1]||(e[1]=t=>a.formData.password=t),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),b(c,{class:"btn-group"},{default:y(()=>[b(h,{type:"primary",loading:a.loading,onClick:o.handleLogin},{default:y(()=>[$("登录")]),_:1},8,["loading","onClick"])]),_:1})]),_:1}),b(u,{ref:"userProfileDialog",paddingBottom:"92rpx"},null,512)]),_:1})}],["__scopeId","data-v-0641bed9"]]);export{Gt as default};
